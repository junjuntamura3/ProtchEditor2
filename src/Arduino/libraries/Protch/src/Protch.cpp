/**
 

**/

#include <Arduino.h>
#include <Wire.h>
#include <Servo.h>
#include <LedControl.h>
#include "Protch.h"


Servo myservo1; //サーボ用のオブジェクトを作成
Servo myservo2; //サーボ用のオブジェクトを作成
LedControl lc=LedControl(PROTCH_LC_DATAIN, PROTCH_LC_CLK, PROTCH_LC_LOAD, 1); //Ledmatrix

static char protchRingBuffer[RING_BUFFER_SIZE] ;
static String protchRetBuf ;
static int p_wpos, p_rpos ;
static int m_r_calibration ;  // モーターキャリブレーション　右
static int m_l_calibration ;  // モーターキャリブレーション　左


#ifdef FOR_PROTCH
static byte lc_char[106][8]={
{B00000000,B11111100,B00010010,B00010010,B00010010,B11111100,B00000000,B00000000},
{B00000000,B11111110,B10010010,B10010010,B10010010,B01111100,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10000010,B10000010,B01000100,B00000000,B00000000},
{B00000000,B11111110,B10000010,B10000010,B10000010,B01111100,B00000000,B00000000},
{B00000000,B11111110,B10010010,B10010010,B10010010,B10010010,B00000000,B00000000},
{B00000000,B11111110,B00010010,B00010010,B00010010,B00000010,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10100010,B10100010,B01100100,B00000000,B00000000},
{B00000000,B11111110,B00010000,B00010000,B00010000,B11111110,B00000000,B00000000},
{B00000000,B00000000,B00000000,B11111110,B00000000,B00000000,B00000000,B00000000},
{B00000000,B01100000,B10000000,B10000000,B10000000,B01111110,B00000000,B00000000},
{B00000000,B11111110,B00010000,B00101000,B01000100,B10000010,B00000000,B00000000},
{B00000000,B11111110,B10000000,B10000000,B10000000,B10000000,B00000000,B00000000},
{B00000000,B11111110,B00000100,B00001000,B00000100,B11111110,B00000000,B00000000},
{B00000000,B11111110,B00001000,B00010000,B00100000,B11111110,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10000010,B10000010,B01111100,B00000000,B00000000},
{B00000000,B11111110,B00010010,B00010010,B00010010,B00001100,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10100010,B11000010,B01111100,B10000000,B00000000},
{B00000000,B11111110,B00010010,B00110010,B01010010,B10001100,B00000000,B00000000},
{B00000000,B01001100,B10010010,B10010010,B10010010,B01100100,B00000000,B00000000},
{B00000000,B00000010,B00000010,B11111110,B00000010,B00000010,B00000000,B00000000},
{B00000000,B01111110,B10000000,B10000000,B10000000,B01111110,B00000000,B00000000},
{B00000000,B00111110,B01000000,B10000000,B01000000,B00111110,B00000000,B00000000},
{B00000000,B11111110,B01000000,B00100000,B01000000,B11111110,B00000000,B00000000},
{B00000000,B11000110,B00101000,B00010000,B00101000,B11000110,B00000000,B00000000},
{B00000000,B00000110,B00001000,B11110000,B00001000,B00000110,B00000000,B00000000},
{B00000000,B11000010,B10100010,B10010010,B10001010,B10000110,B00000000,B00000000},
{B00000000,B00000100,B10000100,B01110100,B00000100,B00010100,B00001100,B00000000},
{B00000000,B00100000,B00100000,B00010000,B11111000,B00000100,B00000010,B00000000},
{B00000000,B00011100,B10000100,B10000110,B01000100,B00111100,B00000000,B00000000},
{B00000000,B10000100,B10000100,B11111100,B10000100,B10000100,B00000000,B00000000},
{B00000000,B01001000,B00101000,B10011000,B11111110,B00001000,B00001000,B00000000},
{B00000000,B10000100,B01000100,B00111110,B00000100,B10000100,B01111100,B00000000},
{B00000000,B00010000,B00010100,B00011110,B01110100,B10010100,B00010000,B00000000},
{B00000000,B00010000,B10001110,B10000100,B01000100,B00111100,B00000000,B00000000},
{B00000000,B00010000,B10001110,B10001000,B01111000,B00001000,B00001000,B00000000},
{B00000000,B10000100,B10000100,B10000100,B10000100,B11111100,B00000000,B00000000},
{B00000000,B00001000,B00111110,B10001000,B10001000,B01111110,B00001000,B00000000},
{B00000000,B10001000,B10010010,B10000100,B01000000,B00100000,B00011000,B00000000},
{B00000000,B10000100,B01000100,B00110100,B00101100,B11000000,B00000000,B00000000},
{B00000000,B00001000,B01111110,B10001000,B10000100,B10100100,B10011100,B00000000},
{B00000000,B00000100,B10011000,B10000000,B01000000,B00111100,B00000000,B00000000},
{B00000000,B00010000,B10001110,B10010100,B01100100,B00111100,B00000000,B00000000},
{B00000000,B00010000,B10010100,B10010100,B01111100,B00010010,B00010000,B00000000},
{B00000000,B00001000,B10010000,B10000100,B10001000,B01000000,B00111100,B00000000},
{B00000000,B00010000,B10010100,B10010100,B01110100,B00010100,B00010000,B00000000},
{B00000000,B00000000,B11111110,B00010000,B00010000,B00100000,B00000000,B00000000},
{B00000000,B10001000,B10001000,B01001000,B00111110,B00001000,B00001000,B00000000},
{B00000000,B10000000,B10000100,B10000100,B10000100,B10000100,B10000000,B00000000},
{B00000000,B10000100,B10010100,B01010100,B00100100,B01011100,B10000000,B00000000},
{B00000000,B00100100,B00100100,B11110110,B00011100,B00100100,B00000000,B00000000},
{B00000000,B10000000,B10000000,B01000000,B00110000,B00001100,B00000000,B00000000},
{B11000000,B00111100,B00000000,B00000000,B00000100,B00011000,B11100000,B00000000},
{B00000000,B01111110,B10001000,B10001000,B10001000,B10000100,B00000000,B00000000},
{B00000000,B00000100,B10000100,B10000100,B01000100,B00111100,B00000000,B00000000},
{B00000000,B00100000,B00010000,B00001000,B00010000,B00100000,B01000000,B00000000},
{B00000000,B01100100,B00000100,B11111110,B00000100,B01100100,B00000000,B00000000},
{B00000000,B00000100,B00010100,B00100100,B11000100,B00100100,B00011100,B00000000},
{B00000000,B00000000,B01001010,B01001010,B10010100,B10010100,B00000000,B00000000},
{B10000000,B11000000,B10111000,B10000110,B01000000,B01100000,B10000000,B00000000},
{B00000000,B10000000,B01001000,B00101000,B00010000,B01101110,B00000000,B00000000},
{B00000000,B00010100,B01111100,B10010100,B10010100,B10010100,B00000000,B00000000},
{B00010000,B00010010,B00011100,B11101000,B00000100,B00100100,B00011100,B00000000},
{B00000000,B10000000,B10000100,B10000100,B11111100,B10000000,B10000000,B00000000},
{B00000000,B00000000,B10010100,B10010100,B10010100,B11111100,B00000000,B00000000},
{B00000000,B00001000,B00001010,B10001010,B10001010,B01001010,B00111000,B00000000},
{B00000000,B00000000,B10011110,B10000000,B01000000,B00111110,B00000000,B00000000},
{B00000000,B11000000,B00111100,B00000000,B11111110,B10000000,B01000000,B00110000},
{B00000000,B00000000,B11111110,B10000000,B01000000,B00110000,B00000000,B00000000},
{B00000000,B11111100,B10000100,B10000100,B10000100,B11111100,B00000000,B00000000},
{B00000000,B00011100,B00000100,B10000100,B10000100,B01000100,B00111100,B00000000},
{B00000000,B00010100,B10010100,B10010100,B01010100,B00111100,B00000000,B00000000},
{B00000000,B10000100,B10001000,B10000000,B01000000,B00100000,B00011000,B00000000},
{B00000000,B00000000,B00010000,B00010000,B00010000,B00010000,B00010000,B00000000},
{B00000000,B00000000,B00010000,B00000000,B01010000,B01000000,B00100000,B00000000},
{B00000000,B00000000,B00010000,B01111000,B00010000,B00110000,B00010000,B00000000},
{B00000000,B00000000,B01000000,B01010000,B01110000,B01000000,B00000000,B00000000},
{B00000000,B00000000,B00000000,B01010100,B01111100,B00000000,B00000000,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00000110,B00000000,B00000110,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00000100,B00001010,B00000100,B00000000},
{B00000000,B00000000,B11111110,B10000010,B10000010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B00000000,B10000100,B11111110,B10000000,B00000000,B00000000},
{B00000000,B00000000,B11110010,B10010010,B10010010,B10011110,B00000000,B00000000},
{B00000000,B00000000,B10010010,B10010010,B10010010,B11111110,B00000000,B00000000},
{B00000000,B00110000,B00101000,B00100100,B11111110,B00100000,B00000000,B00000000},
{B00000000,B00000000,B10011110,B10010010,B10010010,B11110010,B00000000,B00000000},
{B00000000,B00000000,B11111110,B10010010,B10010010,B11110010,B00000000,B00000000},
{B00000000,B00000000,B00001110,B00000010,B00000010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B11111110,B10010010,B10010010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B10011110,B10010010,B10010010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B00000000,B11011111,B11011111,B00000000,B00000000,B00000000},
{B00000000,B00100000,B01000100,B01000000,B01000000,B01000100,B00100000,B00000000},
{B00011000,B00011000,B00011000,B11111111,B11111111,B00011000,B00011000,B00011000},
{B10000010,B01000101,B00100010,B00010000,B00001000,B01000100,B10100010,B01000001},
{B00111100,B01000010,B10110001,B11010101,B11010101,B10111001,B01000010,B00111100},
{B00000000,B00000000,B00000110,B00000001,B10100001,B00010001,B00001110,B00000000},
{B00000010,B00000101,B00000010,B01111100,B10000010,B10000010,B10000010,B01000100},
{B00000010,B00000101,B00000010,B00000000,B00000000,B00000000,B00000000,B00000000},
{B00011100,B00111110,B01111110,B11111100,B11111100,B01111110,B00111110,B00011100},
{B11000000,B11100000,B11100000,B01111111,B00000110,B00100100,B00011000,B00000000},
{B01111110,B01000110,B01001010,B01010010,B01010010,B01001010,B01000110,B01111110},
{B00111100,B01000010,B10000001,B10011111,B10010001,B10010001,B01000010,B00111100},
{B00111100,B01000010,B10100001,B10010001,B10001001,B10000101,B01000010,B00111100},
{B01000000,B01001110,B10010001,B11110101,B10010101,B01010001,B01001110,B00100000},
{B00001000,B00001100,B00001110,B01111111,B10001110,B01001100,B00001000,B00000000},
{B01000000,B10101100,B10010010,B10110010,B01001100,B10100000,B00010000,B00000000},
{B00000000,B01001000,B11111110,B00100100,B00100100,B01111111,B00010010,B00000000}
/*
{B00000000,B11111100,B00010010,B00010010,B00010010,B00000000,B11111100,B00000000},
{B00000000,B11111110,B10010010,B10010010,B10010010,B00000000,B01111100,B00000000},
{B00000000,B01111100,B10000010,B10000010,B10000010,B01000100,B00000000,B00000000},
{B00000000,B11111110,B10000010,B10000010,B10000010,B01111100,B00000000,B00000000},
{B00000000,B11111110,B10010010,B10010010,B10010010,B10010010,B00000000,B00000000},
{B00000000,B11111110,B00010010,B00010010,B00010010,B00000010,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10100010,B10100010,B01100100,B00000000,B00000000},
{B00000000,B11111110,B00010000,B00010000,B00010000,B11111110,B00000000,B00000000},
{B00000000,B00000000,B00000000,B11111110,B00000000,B00000000,B00000000,B00000000},
{B00000000,B01100000,B10000000,B10000000,B10000000,B01111110,B00000000,B00000000},
{B00000000,B11111110,B00010000,B00101000,B01000100,B10000010,B00000000,B00000000},
{B00000000,B11111110,B10000000,B10000000,B10000000,B10000000,B00000000,B00000000},
{B00000000,B11111110,B00000100,B00001000,B00000100,B11111110,B00000000,B00000000},
{B00000000,B11111110,B00001000,B00010000,B00100000,B11111110,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10000010,B10000010,B01111100,B00000000,B00000000},
{B00000000,B11111110,B00010010,B00010010,B00010010,B00001100,B00000000,B00000000},
{B00000000,B01111100,B10000010,B10100010,B11100010,B11111100,B10000000,B00000000},
{B00000000,B11111110,B00010010,B00110010,B01010010,B10001100,B00000000,B00000000},
{B00000000,B01001100,B10010010,B10010010,B10010010,B01100100,B00000000,B00000000},
{B00000000,B00000010,B00000010,B11111110,B00000010,B00000010,B00000000,B00000000},
{B00000000,B01111110,B10000000,B10000000,B10000000,B01111110,B00000000,B00000000},
{B00000000,B00111110,B01000000,B10000000,B01000000,B00111110,B00000000,B00000000},
{B00000000,B11111110,B01000000,B00100000,B01000000,B11111110,B00000000,B00000000},
{B10000010,B11000110,B00101000,B00010000,B00101000,B11000110,B10000010,B00000000},
{B00000000,B00000110,B00001000,B11110000,B00001000,B00000110,B00000000,B00000000},
{B00000000,B11000010,B10100010,B10010010,B10001010,B10000110,B00000000,B00000000},
{B00000000,B00000100,B10000100,B01110100,B00000100,B00010100,B00001100,B00000000},
{B00000000,B00100000,B00100000,B00010000,B11111000,B00000110,B00000010,B00000000},
{B00000000,B00011100,B10000100,B10000110,B01000100,B00111100,B00000000,B00000000},
{B00000000,B10000100,B10000100,B11111100,B10000100,B10000100,B00000000,B00000000},
{B00000000,B01001000,B00101000,B10011000,B11111110,B00001000,B00001000,B00000000},
{B00000000,B10000100,B01000100,B00111110,B10000100,B10000100,B01111100,B00000000},
{B00100000,B00101000,B00101010,B00111100,B01010100,B10010100,B00010000,B00000000},
{B00000000,B00010000,B10001110,B10000110,B01000110,B00111110,B00000100,B00000000},
{B00000000,B00110000,B10001110,B10001000,B01111000,B00001000,B00001000,B00000000},
{B00000000,B11000010,B11000010,B11000010,B11000010,B11000010,B11111110,B00000000},
{B00000000,B00001000,B00111110,B10001000,B10001000,B01111110,B00001000,B00000000},
{B00011110,B10000000,B10001000,B10000100,B01000000,B00100000,B00011000,B00000000},
{B00000000,B10000100,B01000100,B00110100,B00101100,B11000100,B00000000,B00000000},
{B00000000,B00001000,B01111110,B10001000,B10000100,B10100100,B10011100,B00000000},
{B00001000,B00000100,B10011000,B10000000,B01000000,B00111100,B00000000,B00000000},
{B00000000,B00010000,B10001110,B10010100,B01100100,B00111100,B00000000,B00000000},
{B00000000,B11111111,B00010000,B10010100,B10010100,B00010010,B00010000,B00000000},
{B00000000,B00001000,B10010000,B10000100,B10001000,B01000000,B00111100,B00000000},
{B00001000,B00011000,B10011000,B10011000,B11111000,B00011000,B00011000,B00000000},
{B00000000,B00000000,B11111110,B00110000,B00110000,B00100000,B00100000,B00000000},
{B00000000,B10001000,B10001000,B01001000,B00111110,B00001000,B00001000,B00000000},
{B00000000,B10000000,B10000100,B10000100,B10000100,B10000100,B10000000,B00000000},
{B00000010,B10001010,B00101010,B10101010,B01001010,B10111010,B00000010,B00000000},
{B00000000,B00100100,B00100100,B11110110,B00011100,B00100100,B00000000,B00000000},
{B00000000,B10000000,B10000000,B01000000,B00110000,B00001100,B00000000,B00000000},
{B11000000,B00111110,B00001100,B00000110,B00000000,B00011000,B11100000,B00000000},
{B00000000,B01111110,B10001000,B10001000,B10001000,B10000100,B00000000,B00000000},
{B00000000,B00000100,B10000100,B10000100,B01000100,B00111100,B00000000,B00000000},
{B01000000,B01010000,B01001000,B01000100,B01011000,B01010000,B01100000,B00000000},
{B00000000,B01100100,B00000100,B11111110,B00000100,B01100100,B00000000,B00000000},
{B00000000,B00000100,B00010100,B00100100,B11000100,B00100100,B00011100,B00000000},
{B00000000,B01010100,B01110110,B01000110,B10011010,B10011010,B00000000,B00000000},
{B10000000,B11000000,B10111000,B10000110,B01000000,B01100000,B10000000,B00000000},
{B00000000,B10000000,B01001000,B00101000,B00010000,B01100000,B00001110,B00000000},
{B00000000,B00010100,B01111100,B10010100,B10010100,B10010100,B00000000,B00000000},
{B00011000,B00011000,B00011110,B11101010,B00001100,B00101100,B00011110,B00000000},
{B00000000,B10000000,B10000100,B10000100,B11111100,B10000000,B10000000,B00000000},
{B00000000,B00000000,B10010100,B10010100,B10010100,B11111100,B00000000,B00000000},
{B00000000,B00001000,B00001010,B10001010,B10001010,B01001010,B00111000,B00000000},
{B00000000,B00000000,B10011110,B10000000,B01000000,B00111110,B00000000,B00000000},
{B00000000,B11000000,B00111100,B00000000,B11111110,B10000000,B01000000,B00100000},
{B00000000,B00000000,B11111110,B10000000,B01000000,B00110000,B00000000,B00000000},
{B00000000,B11111100,B10000100,B10000100,B10000100,B11111100,B00000000,B00000000},
{B00000000,B00011100,B00000100,B10000100,B10000100,B01000100,B00111100,B00000000},
{B00000000,B00000000,B00001010,B10001010,B10001010,B01001010,B00111110,B00000000},
{B00000000,B10010100,B10001000,B10000000,B01000000,B00100000,B00011000,B00000000},
{B00000000,B00000000,B00010000,B00010000,B00010000,B00010000,B00010000,B00000000},
{B00000000,B00000000,B00010000,B00000000,B01010000,B01000000,B00100000,B00000000},
{B00000000,B00000000,B00010000,B01111000,B00010000,B00110000,B00010000,B00000000},
{B00000000,B00000000,B01000000,B01010000,B01110000,B01000000,B00000000,B00000000},
{B00000000,B00000000,B00000000,B01010100,B01111100,B00000000,B00000000,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00000110,B00000000,B00000110,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00000100,B00001010,B00000100,B00000000},
{B00000000,B00000000,B11111110,B10000010,B10000010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B00000000,B10000100,B11111110,B10000000,B00000000,B00000000},
{B00000000,B00000000,B11110010,B10010010,B10010010,B10011110,B00000000,B00000000},
{B00000000,B00000000,B10010010,B10010010,B10010010,B11111110,B00000000,B00000000},
{B00000000,B00110000,B00101000,B00100100,B11111110,B00100000,B00000000,B00000000},
{B00000000,B00000000,B10011110,B10010010,B10010010,B11110010,B00000000,B00000000},
{B00000000,B00000000,B11111110,B10010010,B10010010,B11110010,B00000000,B00000000},
{B00000000,B00000000,B00001110,B00000010,B00000010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B11111110,B10010010,B10010010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B10011110,B10010010,B10010010,B11111110,B00000000,B00000000},
{B00000000,B00000000,B00000000,B11011111,B11011111,B00000000,B00000000,B00000000},
{B00000000,B00100000,B01000100,B01000000,B01000000,B01000100,B00100000,B00000000},
{B00011000,B00011000,B00011000,B11111111,B11111111,B00011000,B00011000,B00011000},
{B10000010,B01000101,B00100010,B00010000,B00001000,B01000100,B10100010,B01000001},
{B00111100,B01000010,B10110001,B11010101,B11010101,B10111001,B01000010,B00111100},
{B00000000,B00000000,B00000110,B00000001,B10100001,B00010001,B00001110,B00000000},
{B00000010,B00000101,B00111010,B01000100,B10000010,B10000010,B01000100,B00000000},
{B00000010,B00000101,B00000010,B00000000,B00000000,B00000000,B00000000,B00000000},
{B00011100,B00111110,B01111110,B11111100,B11111100,B01111110,B00111110,B00011100},
{B11000000,B11100000,B11100000,B01111111,B00000110,B00100100,B00011000,B00000000},
{B01111110,B01000110,B01001010,B01010010,B01010010,B01001010,B01000110,B01111110},
{B00111100,B01000010,B10000001,B10011101,B10010001,B10010001,B01000110,B00111100},
{B00111100,B01000010,B10100001,B10010001,B10001001,B10000101,B01000010,B00111100},
{B00100000,B01001110,B10010001,B11110101,B10010101,B01010001,B01001110,B00100000},
{B00001000,B00001100,B00001110,B01111111,B10001110,B01001100,B00001000,B00000000},
{B11111110,B01000000,B10101100,B10010010,B10111010,B01001100,B10100000,B00000000},
{B00000000,B01100100,B11111110,B01010010,B01010010,B01111111,B01010010,B00000000}
*/
};
#endif

#ifdef FOR_ASIMOF
static byte lc_char[106][8]={
{B00000000,B00111000,B01000100,B01000100,B01111100,B01000100,B01000100,B01000100},
{B00000000,B01111000,B01000100,B01000100,B01111100,B01000100,B01000100,B01111000},
{B00000000,B00111000,B01000100,B01000000,B01000000,B01000000,B01000100,B00111000},
{B00000000,B01111000,B01000100,B01000100,B01000100,B01000100,B01000100,B01111000},
{B00000000,B01111100,B01000000,B01000000,B01111100,B01000000,B01000000,B01111100},
{B00000000,B01111100,B01000000,B01000000,B01111000,B01000000,B01000000,B01000000},
{B00000000,B00111000,B01000100,B01000000,B01000000,B01011100,B01000100,B00111000},
{B00000000,B01000100,B01000100,B01000100,B01111100,B01000100,B01000100,B01000100},
{B00000000,B00010000,B00010000,B00010000,B00010000,B00010000,B00010000,B00010000},
{B00000000,B00000100,B00000100,B00000100,B00000100,B01000100,B01000100,B00111000},
{B00000000,B01000100,B01001000,B01010000,B01100000,B01010000,B01001000,B01000100},
{B00000000,B01000000,B01000000,B01000000,B01000000,B01000000,B01000000,B01111100},
{B00000000,B01000100,B01101100,B01010100,B01000100,B01000100,B01000100,B01000100},
{B00000000,B01000100,B01000100,B01100100,B01010100,B01001100,B01000100,B01000100},
{B00000000,B00111000,B01000100,B01000100,B01000100,B01000100,B01000100,B00111000},
{B00000000,B01111000,B01000100,B01000100,B01111000,B01000000,B01000000,B01000000},
{B00000000,B00111000,B01000100,B01000100,B01000100,B01010100,B01001100,B00111010},
{B00000000,B01111000,B01000100,B01000100,B01111000,B01010000,B01001000,B01000100},
{B00000000,B00111000,B01000100,B01000000,B00111000,B00000100,B01000100,B00111000},
{B00000000,B01111100,B00010000,B00010000,B00010000,B00010000,B00010000,B00010000},
{B00000000,B01000100,B01000100,B01000100,B01000100,B01000100,B01000100,B00111000},
{B00000000,B01000100,B01000100,B01000100,B01000100,B01000100,B00101000,B00010000},
{B00000000,B01000100,B01000100,B01000100,B01000100,B01010100,B01101100,B01000100},
{B00000000,B01000100,B01000100,B00101000,B00010000,B00101000,B01000100,B01000100},
{B00000000,B01000100,B01000100,B00101000,B00010000,B00010000,B00010000,B00010000},
{B00000000,B01111100,B00000100,B00001000,B00010000,B00100000,B01000000,B01111100},
{B00000000,B00000000,B01111110,B00000010,B00010100,B00010000,B00010000,B00100000},
{B00000000,B00000010,B00000100,B00001000,B00011000,B01101000,B00001000,B00001000},
{B00000000,B00010000,B01111100,B01000100,B01000100,B00000100,B00001000,B00110000},
{B00000000,B00000000,B01111100,B00010000,B00010000,B00010000,B00010000,B01111100},
{B00000000,B00001000,B00001000,B01111110,B00011000,B00101000,B01001000,B00011000},
{B00000000,B00010000,B01111110,B00010010,B00010010,B00010010,B00100010,B01000100},
{B00000000,B00010000,B00111100,B00010000,B01111110,B00001000,B00001000,B00000100},
{B00000000,B00100000,B00111100,B00100100,B01000100,B00000100,B00001000,B00110000},
{B00000000,B00100000,B00100000,B00111110,B01001000,B00001000,B00001000,B00110000},
{B00000000,B00000000,B01111100,B00000100,B00000100,B00000100,B00000100,B01111100},
{B00000000,B00100100,B00100100,B01111110,B00100100,B00100100,B00000100,B00011000},
{B00000000,B00100000,B00010000,B01000010,B00100010,B00000100,B00001000,B01110000},
{B00000000,B00000000,B01111000,B00001000,B00010000,B00011000,B00100100,B01000100},
{B00000000,B00100000,B00101110,B01110010,B00100010,B00100100,B00100000,B00011110},
{B00000000,B00000000,B01000100,B00100100,B00100100,B00000100,B00001000,B00110000},
{B00000000,B00100000,B00111100,B00100100,B01010100,B00001100,B00001000,B00110000},
{B00000000,B00000100,B00111000,B00001000,B01111110,B00001000,B00001000,B00110000},
{B00000000,B00000000,B00010010,B01001010,B00100010,B00000010,B00000100,B00111000},
{B00000000,B00000000,B00111100,B00000000,B01111110,B00001000,B00001000,B00110000},
{B00000000,B00100000,B00100000,B00100000,B00111000,B00100100,B00100000,B00100000},
{B00000000,B00001000,B00001000,B01111110,B00001000,B00001000,B00010000,B01100000},
{B00000000,B00000000,B00111100,B00000000,B00000000,B00000000,B00000000,B01111110},
{B00000000,B00000000,B01111100,B00000100,B00110100,B00001000,B00010100,B01100010},
{B00000000,B00010000,B01111100,B00001000,B00011000,B01110100,B00010000,B00010000},
{B00000000,B00000000,B00000100,B00000100,B00001000,B00001000,B00010000,B01100000},
{B00000000,B00000000,B01001000,B01000100,B01000100,B01000010,B10000010,B10000010},
{B00000000,B01000000,B01000100,B01111000,B01000000,B01000000,B01000000,B00111100},
{B00000000,B00000000,B01111100,B00000100,B00000100,B00000100,B00001000,B00110000},
{B00000000,B00000000,B00000000,B00010000,B00101000,B01000100,B00000010,B00000000},
{B00000000,B00010000,B01111100,B00010000,B00010000,B01010100,B01010100,B00010000},
{B00000000,B00000000,B01111110,B00000010,B00100010,B00010100,B00001000,B00001000},
{B00000000,B00110000,B00001100,B00110000,B00001100,B00000000,B00110000,B00001100},
{B00000000,B00010000,B00010000,B00100000,B00100000,B00100100,B01001100,B11110010},
{B00000000,B00000100,B00000100,B00110100,B00001000,B00010100,B00100100,B01000000},
{B00000000,B00000000,B01111100,B00100000,B01111100,B00100000,B00100000,B00011100},
{B00000000,B01000000,B00101110,B00110010,B11100010,B00010100,B00010000,B00010000},
{B00000000,B00000000,B00111000,B00001000,B00001000,B00001000,B00001000,B01111110},
{B00000000,B00000000,B00111100,B00000100,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00111100,B00000000,B01111110,B00000010,B00000010,B00000100,B00011000},
{B00000000,B00100100,B00100100,B00100100,B00100100,B00000100,B00001000,B00110000},
{B00000000,B00001000,B00101000,B00101000,B00101001,B00101001,B01001010,B01001100},
{B00000000,B00100000,B00100000,B00100000,B00100100,B00100100,B00101000,B00110000},
{B00000000,B00000000,B01111100,B01000100,B01000100,B01000100,B01000100,B01111100},
{B00000000,B00000000,B01111110,B01000010,B01000010,B00000010,B00000100,B00011000},
{B00000000,B00000000,B01111100,B00000100,B01111100,B00000100,B00001000,B00110000},
{B00000000,B00000000,B01000000,B00100010,B00000010,B00000100,B00001000,B01110000},
{B00000000,B00000000,B00000000,B00000000,B00111110,B00000000,B00000000,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00101000,B00000010,B00001100,B00000000},
{B00000000,B00000000,B00000000,B00010000,B00111110,B00010100,B00010000,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00011000,B00001000,B00111100,B00000000},
{B00000000,B00000000,B00011000,B00001000,B00011000,B00001000,B00011000,B00000000},
{B00000000,B00001010,B00001010,B00000000,B00000000,B00000000,B00000000,B00000000},
{B00000000,B00000100,B00001010,B00000100,B00000000,B00000000,B00000000,B00000000},
{B00000000,B00111100,B00100100,B00100100,B00100100,B00100100,B00100100,B00111100},
{B00000000,B00001000,B00011000,B00001000,B00001000,B00001000,B00001000,B00011100},
{B00000000,B00111100,B00000100,B00000100,B00111100,B00100000,B00100000,B00111100},
{B00000000,B00111100,B00000100,B00000100,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00001000,B00011000,B00101000,B01001000,B01111100,B00001000,B00001000},
{B00000000,B00111100,B00100000,B00100000,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00111100,B00100000,B00100000,B00111100,B00100100,B00100100,B00111100},
{B00000000,B00111100,B00100100,B00100100,B00000100,B00000100,B00000100,B00000100},
{B00000000,B00111100,B00100100,B00100100,B00111100,B00100100,B00100100,B00111100},
{B00000000,B00111100,B00100100,B00100100,B00111100,B00000100,B00000100,B00111100},
{B00011000,B00011000,B00011000,B00011000,B00011000,B00000000,B00011000,B00011000},
{B00000000,B00000000,B00100100,B00000000,B00000000,B01000010,B00111100,B00000000},
{B00011000,B00011000,B00011000,B11111111,B11111111,B00011000,B00011000,B00011000},
{B01000001,B10100010,B01000100,B00001000,B00010000,B00100010,B01000101,B10000010},
{B00111100,B01000010,B10011001,B10000101,B10111101,B10100101,B01011010,B00111100},
{B00011100,B00100010,B00100010,B00000010,B00000100,B00001000,B00000000,B00001000},
{B01000000,B10101110,B01010001,B00010000,B00010000,B00010000,B00010001,B00001110},
{B01000000,B10100000,B01000000,B00000000,B00000000,B00000000,B00000000,B00000000},
{B00000000,B01100110,B11111111,B11111111,B11111111,B01111110,B00111100,B00011000},
{B00010000,B00011000,B00011100,B00010010,B00010010,B01110100,B11110000,B11100000},
{B00000000,B11111111,B11000011,B10100101,B10011001,B10000001,B11111111,B00000000},
{B00111100,B01010010,B10010001,B10010001,B10011101,B10000001,B01000010,B00111100},
{B00111100,B01000010,B10000101,B10001001,B10010001,B10100001,B01000010,B00111100},
{B00111100,B01000010,B01011010,B01000010,B00111100,B00010001,B11010110,B00111000},
{B00010000,B00111000,B01111100,B11111110,B00010000,B00010000,B00010100,B00001000},
{B00000000,B00110000,B01001000,B01001000,B00110010,B01010100,B10001000,B01110100},
{B00000100,B00100110,B00111100,B01100100,B00100110,B00111100,B01100100,B00100000}
/*
{B00000000,B00111000,B01000010,B01000010,B01111010,B01000010,B01000010,B01000010},
{B00000000,B01111000,B01000010,B01000010,B01111010,B01000010,B01000010,B01111000},
{B00000000,B00111000,B01000100,B01000000,B01000000,B01000000,B01000100,B00111000},
{B00000000,B01111000,B01000100,B01000100,B01000100,B01000100,B01000100,B01111000},
{B00000000,B01111100,B01000000,B01000000,B01111100,B01000000,B01000000,B01111100},
{B00000000,B01111100,B01000000,B01000000,B01111000,B01000000,B01000000,B01000000},
{B00000000,B00111000,B01000100,B01000000,B01000000,B01011100,B01000100,B00111000},
{B00000000,B01000100,B01000100,B01000100,B01111100,B01000100,B01000100,B01000100},
{B00000000,B00010000,B00010000,B00010000,B00010000,B00010000,B00010000,B00010000},
{B00000000,B00000100,B00000100,B00000100,B00000100,B01000100,B01000100,B00111000},
{B00000000,B01000100,B01001000,B01010000,B01100000,B01010000,B01001000,B01000100},
{B00000000,B01000000,B01000000,B01000000,B01000000,B01000000,B01000000,B01111100},
{B00000000,B01000100,B01101100,B01010100,B01000100,B01000100,B01000100,B01000100},
{B00000000,B01000100,B01000100,B01100100,B01010100,B01001100,B01000100,B01000100},
{B00000000,B00111000,B01000100,B01000100,B01000100,B01000100,B01000100,B00111000},
{B00000000,B01111000,B01000100,B01000100,B01111000,B01000000,B01000000,B01000000},
{B00000000,B00111000,B01000100,B01000100,B01000100,B01011100,B01001100,B00111110},
{B00000000,B01111000,B01000100,B01000100,B01111000,B01010000,B01001000,B01000100},
{B00000000,B00111000,B01000100,B01000000,B00111000,B00000100,B01000100,B00111000},
{B00000000,B01111100,B00010000,B00010000,B00010000,B00010000,B00010000,B00010000},
{B00000000,B01000100,B01000100,B01000100,B01000100,B01000100,B01000100,B00111000},
{B00000000,B01000100,B01000100,B01000100,B01000100,B01000100,B00101000,B00010000},
{B00000000,B01000100,B01000100,B01000100,B01000100,B01010100,B01101100,B01000100},
{B00000000,B11000110,B01000100,B00101000,B00010000,B00101000,B01000100,B11000110},
{B00000000,B01000100,B01000100,B00101000,B00010000,B00010000,B00010000,B00010000},
{B00000000,B01111100,B00000100,B00001000,B00010000,B00100000,B01000000,B01111100},
{B00000000,B00000000,B01111110,B00000010,B00010100,B00010000,B00010000,B00100000},
{B00000000,B00000110,B00000100,B00001000,B00011000,B01101000,B00001000,B00001000},
{B00000000,B00010000,B01111100,B01000100,B01000100,B00000100,B00001000,B00110000},
{B00000000,B00000000,B01111100,B00010000,B00010000,B00010000,B00010000,B01111100},
{B00000000,B00001000,B00001000,B01111110,B00011000,B00101000,B01001000,B00011000},
{B00000000,B00010000,B01111110,B00010010,B00010010,B00010010,B00100010,B01001100},
{B00000000,B00100000,B00011100,B01110000,B00011110,B11110000,B00001000,B00000100},
{B00000000,B00111100,B00111110,B00100100,B01000100,B00000100,B00001000,B00110000},
{B00000000,B00100000,B00100000,B00111110,B01001000,B01001000,B00001000,B00110000},
{B00000000,B01111110,B00000010,B00000010,B00000010,B00000010,B01111110,B01111110},
{B00000000,B00100100,B00100100,B01111110,B00100100,B00100100,B00000100,B00011000},
{B00000000,B10000000,B10010000,B10100010,B10000010,B00000100,B00001000,B01110000},
{B00000000,B00000000,B01111100,B00001000,B00010000,B00011000,B00100100,B01000100},
{B00000000,B00100000,B00101110,B01110010,B00100010,B00100100,B00100000,B00011110},
{B00000000,B00000000,B01000100,B10100100,B00100100,B00000100,B00001000,B00110000},
{B00000000,B00100000,B00111100,B00100100,B01010100,B00001100,B00001000,B00110000},
{B01000000,B01000100,B01011000,B01000000,B01111110,B01000000,B01000000,B01011000},
{B00000000,B00000000,B00010010,B01001010,B00100010,B00000010,B00000100,B00111000},
{B00000000,B00000000,B00000000,B11111110,B01111110,B00001000,B00001000,B00111000},
{B00000000,B00100000,B00100000,B00100000,B00111000,B00111110,B00100000,B00100000},
{B00000000,B00001000,B00001000,B01111110,B00001000,B00001000,B00010000,B01100000},
{B00000000,B00000000,B00111100,B00000000,B00000000,B00000000,B00000000,B01111110},
{B00000000,B11111110,B00000000,B01111100,B00000100,B00110100,B00001000,B01010100},
{B00000000,B00010000,B01111100,B00001000,B00011000,B01110100,B00010000,B00010000},
{B00000000,B00000000,B00000100,B00000100,B00001000,B00001000,B00010000,B01100000},
{B00000000,B01010000,B01110000,B01100100,B01000100,B01000010,B10000010,B10000010},
{B00000000,B01000000,B01000100,B01111000,B01000000,B01000000,B01000000,B00111100},
{B00000000,B00000000,B01111100,B00000100,B00000100,B00000100,B00001000,B00110000},
{B00000000,B00000000,B00010000,B00101000,B01001100,B00000010,B11111110,B00000000},
{B00000000,B00010000,B01111100,B00010000,B00010000,B01010100,B01010100,B00010000},
{B00000000,B00000000,B01111110,B00000010,B00100010,B00010100,B00001000,B00001000},
{B00000000,B00111100,B01110000,B00001100,B01101100,B00100000,B01110000,B00001100},
{B00000000,B00010000,B00010000,B00100000,B00100000,B00100100,B01001100,B11110010},
{B00000000,B00000010,B00000010,B00110010,B00001000,B00010100,B00100100,B01000000},
{B00000000,B00000000,B01111100,B00100000,B01111100,B00100000,B00100000,B00011100},
{B00000000,B00110010,B00101110,B11111110,B11100010,B00010100,B00010000,B00010000},
{B00000000,B00000000,B00111000,B00001000,B00001000,B00001000,B00001000,B01111110},
{B00000000,B00000000,B00111100,B00000100,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00111100,B00000000,B01111110,B00000010,B00000010,B00000100,B00011000},
{B00000000,B00100100,B00100100,B00100100,B00100100,B00000100,B00001000,B00110000},
{B00000000,B00001000,B00101000,B00101000,B00101000,B00101001,B01001010,B01001100},
{B00000000,B00100000,B00100000,B00100000,B00100100,B00100100,B00101000,B00110000},
{B00000000,B00000000,B01111100,B01000100,B01000100,B01000100,B01000100,B01111100},
{B00000000,B00000000,B01111110,B01000010,B01000010,B00000010,B00000100,B00011000},
{B00000000,B00111110,B00000010,B00111110,B00000010,B00000010,B00000100,B00011000},
{B00000000,B00000000,B01000000,B00100010,B01000010,B00000100,B00001000,B01110000},
{B00000000,B00000000,B00000000,B00000000,B00111110,B00000000,B00000000,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00101000,B00000010,B00001100,B00000000},
{B00000000,B00000000,B00000000,B00010000,B00111110,B00010100,B00010000,B00000000},
{B00000000,B00000000,B00000000,B00000000,B00011000,B00001000,B00111100,B00000000},
{B00000000,B00000000,B00011000,B00001000,B00011000,B00001000,B00011000,B00000000},
{B00000000,B00001010,B00001010,B00000000,B00000000,B00000000,B00000000,B00000000},
{B00000000,B00000100,B00001010,B00000100,B00000000,B00000000,B00000000,B00000000},
{B00000000,B00111100,B00100100,B00100100,B00100100,B00100100,B00100100,B00111100},
{B00000000,B00001000,B00011000,B00001000,B00001000,B00001000,B00001000,B00011100},
{B00000000,B00111100,B00000100,B00000100,B00111100,B00100000,B00100000,B00111100},
{B00000000,B00111100,B00000100,B00000100,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00001000,B00011000,B00101000,B01001000,B01111100,B00001000,B00001000},
{B00000000,B00111100,B00100000,B00100000,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00111100,B00100000,B00100000,B00111100,B00100100,B00100100,B00111100},
{B00000000,B00111100,B00100100,B00100100,B00000100,B00000100,B00000100,B00000100},
{B00000000,B00111100,B00100100,B00100100,B00111100,B00100100,B00100100,B00111100},
{B00000000,B00111100,B00100100,B00100100,B00111100,B00000100,B00000100,B00111100},
{B00000000,B00000000,B00000000,B11011111,B11011111,B00000000,B00000000,B00000000},
{B00000000,B00000000,B00100100,B00000000,B00000000,B01000010,B00111100,B00000000},
{B10000001,B01000010,B00100100,B00011000,B00011000,B00100100,B01000010,B10000001},
{B01000001,B10100010,B01000100,B00001000,B00010000,B00100010,B01000101,B10000010},
{B00111100,B01000010,B10011001,B10000101,B10111101,B10100101,B01011010,B00111100},
{B00011100,B00100010,B00100010,B00000010,B00000100,B00001000,B00000000,B00001000},
{B01000000,B10101100,B01010010,B00100000,B00100000,B00100000,B00010010,B00001100},
{B01000000,B10100000,B01000000,B00000000,B00000000,B00000000,B00000000,B00000000},
{B00000000,B01100110,B11111111,B11111111,B11111111,B01111110,B00111100,B00011000},
{B00010000,B00011000,B00011100,B00010010,B00010010,B01110100,B11110000,B11100000},
{B00000000,B11111111,B11000011,B10100101,B10011001,B10000001,B11111111,B00000000},
{B00111100,B01000010,B10010011,B10010001,B10011101,B10000001,B01000010,B00111100},
{B00111100,B01000010,B10000101,B10001001,B10010001,B10100001,B01000010,B00111100},
{B00111100,B01000010,B01011010,B01000010,B00111100,B10010001,B01010110,B00111000},
{B00010000,B00111000,B01111100,B11111110,B00010000,B00010000,B00010100,B00001000},
{B00000000,B10011000,B10100100,B10101100,B10011000,B10101010,B11000100,B10111010},
{B00000100,B00111110,B01100100,B00100100,B00111110,B01100100,B01111110,B00100000}
*/
};
#endif


/*
Protchクラス初期化
*/
Protch::Protch() {
	this->init() ;
}

/*
Protchクラス初期化
*/
void Protch::init() {
	/* GPIOの初期化 デジタルのみ*/
	pinMode(PROTCH_C_SW_LEFT, INPUT);
	pinMode(PROTCH_C_SW_RIGHT, INPUT);
	pinMode(PROTCH_MTR1_OUT1, OUTPUT);
	pinMode(PROTCH_MTR1_OUT2, OUTPUT);
	pinMode(PROTCH_MTR1_PWM, OUTPUT);
	pinMode(PROTCH_MTR2_PWM, OUTPUT);
	pinMode(PROTCH_MTR2_OUT1, OUTPUT);
	pinMode(PROTCH_MTR2_OUT2, OUTPUT);
	pinMode(PROTCH_LED_LEFT, OUTPUT);
	pinMode(PROTCH_LED_RIGHT, OUTPUT);
	pinMode(PROTCH_BUZZER, OUTPUT);

	pinMode(PROTCH_TRG, OUTPUT);
//	pinMode(PROTCH_EXT_PSD, INPUT);

	digitalWrite(PROTCH_MTR1_OUT1, 0) ;
	digitalWrite(PROTCH_MTR1_OUT2, 0) ;
	analogWrite(PROTCH_MTR1_PWM, 0) ;
	analogWrite(PROTCH_MTR2_PWM, 0) ;
	digitalWrite(PROTCH_MTR2_OUT1, 0) ;
	digitalWrite(PROTCH_MTR2_OUT2, 0) ;
	digitalWrite(PROTCH_LED_LEFT, 0) ;
	digitalWrite(PROTCH_LED_RIGHT, 0) ;
	digitalWrite(PROTCH_BUZZER, 0) ;
	digitalWrite(PROTCH_TRG, 0) ;

	lc.shutdown(0,false);
	lc.setIntensity(0,PROTCH_LC_BRIGHTNESS);
	lc.clearDisplay(0);

	p_wpos = 0 ;
	p_rpos = 0 ;

	m_r_calibration = 0 ;
	m_l_calibration = 0 ;



}

/*
Protchクラス初期化
*/
void Protch::runwait() {
	uint8_t value ;
	while(1) {
		value = digitalRead(PROTCH_C_SW_LEFT) ;
		if (value == 1) {
			break ;
		}
		value = digitalRead(PROTCH_C_SW_RIGHT) ;
		if (value == 1) {
			break ;
		}
		delay(100) ;
	}
    delay(1000) ;
}

/*
LED制御
	引数：
		pos: PIN番号 (PROTCH_LED_LEFT / PROTCH_LED_RIGHT）
		status: (PROTCH_STATUS_ON / PROTCH_STATUS_OFF)

	返り値：
		無し

*/
void Protch::controlLED(uint8_t pos, uint8_t status) {
	if (myservo1.attached()) {
		myservo1.detach();
	}
	if (myservo2.attached()) {
		myservo2.detach();
	}
	pinMode(PROTCH_LED_LEFT, OUTPUT);
	pinMode(PROTCH_LED_RIGHT, OUTPUT);
	digitalWrite(pos, status) ;
}


/*
接触スイッチ状態取得
	引数：
		pos: PIN番号 (PROTCH_C_SW_LEFT / PROTCH_C_SW_RIGHT)

	返り値：
		PROTCH_STATUS_ON or PROTCH_STATUS_OFF

*/
uint8_t Protch::getContactSwatchStatus(uint8_t pos) {
	uint8_t value ;

	value = digitalRead(pos) ;
	if (value == 1) {
		return PROTCH_STATUS_ON ;
	}
	return PROTCH_STATUS_OFF ;
}

/*
ライトセンサ状態取得
	引数：
		pos: (PROTCH_CDS_LEFT / PROTCH_CDS_RIGHT)	
 
	返り値：
		0～1024までの値

*/
int Protch::getCDSStatus(uint8_t pos) {
	if (pos == PROTCH_CDS_PIN_RIGHT) {
		return analogRead(A1) ;
	}
	return analogRead(A0) ;
}

/*
モーター制御
	引数：
		pos: PIN番号 (PROTCH_MOTOR_LEFT / PROTCH_MOTOR_RIGHT)
		direction: 方向 (PROTCH_MOTOR_D_N / PROTCH_MOTOR_D_R)
		speed: 0～1024
	返り値：
		無し
*/
void Protch::controlMotor(uint8_t pos, uint8_t direction, uint8_t speed) {
	uint8_t target_PA ;
	uint8_t target_PB ;
	uint8_t target_PS ;
	float sval ;
	int calibration_value ;
	
	calibration_value = 0 ;
	if (pos == PROTCH_MOTOR_RIGHT) {
		target_PA = PROTCH_MTR1_OUT1 ;
		target_PB = PROTCH_MTR1_OUT2 ;
		target_PS = PROTCH_MTR1_PWM ;
		calibration_value = m_r_calibration ;
	}else{
		target_PA = PROTCH_MTR2_OUT2 ; 
		target_PB = PROTCH_MTR2_OUT1 ;
		target_PS = PROTCH_MTR2_PWM ;
		calibration_value = m_l_calibration ;
	}
	if (speed <= 0) {
		speed = 0 ;
	}
	if (speed >= 200) {
		speed = 200 ;
	}
	if (speed == 0) {
		digitalWrite(target_PA, 0) ;
		digitalWrite(target_PB, 0) ;
	}else{
		if (direction == PROTCH_MOTOR_D_N) {
			digitalWrite(target_PA, 0) ;
			digitalWrite(target_PB, 1) ;
		}else{
			digitalWrite(target_PA, 1) ;
			digitalWrite(target_PB, 0) ;
		}
	}
	sval = calibration_value ;
	sval = sval / 100 ;
	speed = speed + (speed * sval) ;
	analogWrite(target_PS, speed) ;
}


/*
ブザー制御
	引数：
		Frequency (in hertz) and duration (in milliseconds).
	返り値：
		無し
*/
void Protch::controlBuzzer(uint16_t frequency, uint32_t duration) {
	int period ;
	int pulse ;

	if (frequency == 0) {
		digitalWrite(PROTCH_BUZZER, PROTCH_STATUS_OFF);
	}else{
		period = 1000000L / frequency;
		pulse = period / 2;
		if (duration != 0) {
			for (long i = 0; i < duration * 1000L; i += period) {
				if (frequency == 1) {
					digitalWrite(PROTCH_BUZZER, PROTCH_STATUS_OFF);
				}else{
					digitalWrite(PROTCH_BUZZER, PROTCH_STATUS_ON);
				}
				delayMicroseconds(pulse);
				digitalWrite(PROTCH_BUZZER, PROTCH_STATUS_OFF);
				delayMicroseconds(pulse);
			}
		}else{
			digitalWrite(PROTCH_BUZZER, PROTCH_STATUS_OFF);
		}
	}
}


/*
距離センサー状況取得
	引数：
		なし
	返り値：
		距離（mm）
*/
int Protch::getPSD() {
	double Duration = 0; //受信した間隔
	double Distance = 0; //距離

	digitalWrite(PROTCH_TRG, LOW);
	delayMicroseconds(2);
	digitalWrite(PROTCH_TRG, HIGH);//超音波を出力
	delayMicroseconds(10);
	digitalWrite(PROTCH_TRG, LOW);
	Duration = pulseIn( PROTCH_EXT_PSD, HIGH, 100000 ); //センサからの入力
	if (Duration > 0) {
	    Duration = Duration/2; //往復距離を半分にする
    	    Distance = Duration*340*100/1000000; // 音速を340m/sに設定
            return (int)(Distance*10) ;
	}
	return 0 ;
}
/*

uint16_t Protch::getPSD() {
	double Duration = 0; //受信した間隔
	double Distance = 0; //距離.
        uint16_t tempDistance[PROTCH_AVG_COUNT] ;
        uint16_t tempDistanceFlg[PROTCH_AVG_COUNT]  ;
        uint16_t responseDistance = 0 ;
	int i, j, vcnt ;

	//データ収集
	for (i = 0 ; i < PROTCH_AVG_COUNT ; i++) {
		digitalWrite(PROTCH_TRG, LOW);
		delayMicroseconds(2);
		digitalWrite(PROTCH_TRG, HIGH);//超音波を出力
		delayMicroseconds(10);
		digitalWrite(PROTCH_TRG, LOW);
		Duration = pulseIn( PROTCH_EXT_PSD, HIGH ); //センサからの入力
		if (Duration <= 0) { // センサ入力値が0以下の場合無効
			tempDistance[i] = 0;
			tempDistanceFlg[i] = 0;
			continue ;
		}
		Duration = Duration/2; //往復距離を半分にする
		Distance = Duration*340*100/1000000; // 音速を340m/sに設定
		tempDistance[i] = (uint16_t)(Distance*10) ;
		tempDistanceFlg[i] = 1 ;
	}

	//ノイズ除去
	for (i = 0 ; i < PROTCH_AVG_COUNT ; i++) {
		if (tempDistanceFlg[i] <= 0) {  // 無効データ
			continue ;
		}
		for (j = 0 ; j < PROTCH_AVG_COUNT ; j++) {
			if (tempDistanceFlg[j] <= 0) {  // 無効データ
				continue ;
			}
			if ((tempDistance[i] <= tempDistance[j]*PROTCH_AVG_RANGE_H) && (tempDistance[i] >= tempDistance[j]*PROTCH_AVG_RANGE_L)) {
				// 70%～130%の値の範囲であれば、有効と判断
				tempDistanceFlg[j] =  tempDistanceFlg[j] + 1 ;
			}
		}
	}

	//平準化
	vcnt = 0 ;
	for (i = 0 ; i < PROTCH_AVG_COUNT ; i++) {
		if (tempDistanceFlg[i] <= 1) {  // 無効データ
			continue ;
		}
		vcnt++ ;
		responseDistance = responseDistance + tempDistance[i] ;
	}
	if (responseDistance != 0) {
		return (uint16_t)responseDistance/vcnt ;
	}
	return responseDistance ;
}
*/




/*
バッテリー状況取得
	引数：
		なし
	返り値：
		1～5までの値
*/
uint8_t Protch::getBateryStatus() {
	uint16_t value ;
	
	value = analogRead(PROTCH_EXT_BAT) ;
	if (value < 328) {
		return PROTCH_BATT_1 ;
	}
	if ((value >= 328) and (value < 502)) {
		return PROTCH_BATT_2 ;
	}
	if ((value >= 502) and (value < 676)) {
		return PROTCH_BATT_3 ;
	}
	if ((value >= 676) and (value < 850)) {
		return PROTCH_BATT_4 ;
	}
	return PROTCH_BATT_5 ;
}

/*
ライントレーサーセンサー状況取得
	引数：
		pos : 場所　(1 : 左センサー / 2: 右センサー）
	返り値：
		0～1024までの値
*/
int Protch::getLTS(uint8_t pos) {
	if (pos == PROTCH_LINE_LEFT) {
		return analogRead(PROTCH_EXT_LINE1) ;
	}
	return analogRead(PROTCH_EXT_LINE2) ;
}



/*
SERVO制御
	引数：
		pos: PIN番号 (PROTCH_SERVO_LEFT / PROTCH_SERVO_RIGHT）
		angle: 角度(0-180)

	返り値：
		無し

*/
void Protch::controlServo(uint16_t pos, uint16_t angle) {
	if (!myservo1.attached()) {
		myservo1.attach(PROTCH_SERVO_LEFT);
	}
	if (!myservo2.attached()) {
		myservo2.attach(PROTCH_SERVO_RIGHT);
	}
	if (angle<=0) {
		angle = 0;
	}
	if (angle>=270) {
		angle = 270;
	}
	if (pos == PROTCH_SERVO_LEFT) {
		myservo1.write(angle);
	}
	if (pos == PROTCH_SERVO_RIGHT) {
		myservo2.write(angle);
	}
}



/*
LED Matrix制御
	引数：
		row : 行
		col : 列
		value : ON/OFF (true / false)

	返り値：
		無し

*/
void Protch::controlLedmatrix(uint8_t row, uint8_t col, boolean value) {
#ifdef FOR_PROTCH
	lc.setLed(0, col, (7-row), value);
#endif
#ifdef FOR_ASIMOF
	lc.setLed(0, row, col, value);
#endif
}

/*
LED Matrix制御
	引数：
		code : 表示文字コード（A-Z,a-z,0-9,記号）

	返り値：
		無し

*/
void Protch::controlLedmatrixByChar(uint8_t code) {
	lc.setRow(0,0,lc_char[code][0]);
	lc.setRow(0,1,lc_char[code][1]);
	lc.setRow(0,2,lc_char[code][2]);
	lc.setRow(0,3,lc_char[code][3]);
	lc.setRow(0,4,lc_char[code][4]);
	lc.setRow(0,5,lc_char[code][5]);
	lc.setRow(0,6,lc_char[code][6]);
	lc.setRow(0,7,lc_char[code][7]);

}

/*
LED Matrix制御
	引数：
		row : 行
		value : １行の表示データ（8bit)

	返り値：
		無し

*/
void Protch::controlLedmatrixByRowData(uint8_t row, uint8_t value){
#ifdef FOR_PROTCH
	lc.setColumn(0, row, (byte)value);
#endif
#ifdef FOR_ASIMOF
	lc.setRow(0, row, (byte)value);
#endif
}

/*
LED Matrix制御
	引数：
		col : 行
		value : １行の表示データ（8bit)

	返り値：
		無し

*/
void Protch::controlLedmatrixByColData(uint8_t col, uint8_t value){
#ifdef FOR_PROTCH
	unsigned r = 0;
	int b = 8;

	while (b--) {
		r <<= 1;
		r |= (value & 1);
		value >>= 1;
	}

	lc.setRow(0, (7-col), (byte)r);
#endif
#ifdef FOR_ASIMOF
	lc.setColumn(0, col, (byte)value);
#endif
}

/*
LED Matrix制御
	引数：
		無し
	返り値：
		無し

*/
void Protch::controlLedmatrixClear() {
	lc.clearDisplay(0);
}



/*
シリアルイベントハンドリング
（Serial1)
	引数：
		無し
	返り値：
		無し

*/
void Protch::serialEventHandler() {
	int inValue = 0 ;

	while (Serial1.available()) {
		inValue = Serial1.read() ;
		protchRingBuffer[p_wpos] = inValue ;
		p_wpos++ ;
		if (p_wpos >= RING_BUFFER_SIZE) {
			p_wpos = 0 ;
		}
	}
}



/*
シリアル文字列読み込み
	引数：
		無し
	返り値：
		文字列ポインタ

*/
String Protch::serialStringRead() {

	protchRetBuf = "";
	while(p_rpos != p_wpos) {
		protchRetBuf.concat(protchRingBuffer[p_rpos]);
		p_rpos++ ;
		if (p_rpos >= RING_BUFFER_SIZE) {
			p_rpos = 0 ;
		}
	}
	return protchRetBuf ;
}



/*
シリアル文字列書き込み
	引数：
		文字列ポインタ
	返り値：
		無し

*/
void Protch::serialStringWrite(String value) {
	int l = value.length();

	for(int i=0;i<l;i++){
		if ( (value.charAt(i) == '\r') || (value.charAt(i) == '\n')) {
			continue;
		}
		if ( (value.charAt(i) == 0xff) || (value.charAt(i) == 0x55)) {
			continue;
		}
		Serial1.write(value.charAt(i));
	}
}

/*
停止
	引数：
		無し
	返り値：
		無し

*/
void Protch::stopAll() {
	while(1) {
		delay(1000);
	}
}

/*
モーターキャリブレーション設定
	引数：
		int leftParam	左の較正（0～100%) => %
		int rightParam	右の較正（0～100%）=> %
	返り値：
		無し

*/
void Protch::calibrationMotor(int leftParam, int rightParam) {
	if (leftParam >= 100) {
		leftParam = 100 ;
	}
	if (rightParam >= 100) {
		rightParam = 100 ;
	}
	if (leftParam <= 0) {
		leftParam = 0 ;
	}
	if (rightParam <= 0) {
		rightParam = 0 ;
	}

	if (rightParam >= 128) {
		m_r_calibration = rightParam - 256 ;
	}else{
		m_r_calibration = rightParam ;
	}
	if (leftParam >= 128) {
		m_l_calibration = leftParam - 256 ;
	}else{
		m_l_calibration = leftParam ;
	}
}


